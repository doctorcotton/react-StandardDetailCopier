# 原料标准明细一键复制 - 使用说明（新版）

## 📖 功能介绍

这是一个飞书多维表格插件，通过**双向关联字段**快速复制关联记录。特别适用于原料标准管理场景，可以快速复制一个原料标准的所有检测项明细到另一个原料标准。

## 🎯 核心场景

### 典型使用场景

假设你有两个表：

1. **原料标准管理表**（主表）
   - 记录：凝茶萃取液-HTC8913-002
   - 记录：凝茶萃取液-HTC8913-003
   - 字段：原材料标准明细（双向关联字段）

2. **原料标准明细表**（关联表）
   - 记录：状态、总体、蜡、外形、凝固实验、酵母、氯化物等
   - 字段：关联标准一张表（双向关联，指向原料标准管理表）

### 需求场景

你想把 **HTC8913-002** 的所有检测项明细（11条记录）复制给 **HTC8913-003**，并且新复制的记录要关联到 HTC8913-003。

## 📝 操作步骤

### 步骤1: 选择主表

选择包含源记录和目标记录的主表（如：原料标准管理表）。

![步骤1](./docs/step1.png)

**提示**：插件会自动选择当前激活的表。

---

### 步骤2: 选择源记录

在主表中选择要复制关联记录的源记录。

**示例**：选择 `凝茶萃取液-HTC8913-002`

![步骤2](./docs/step2.png)

---

### 步骤3: 选择关联字段

选择要复制的双向关联字段。

**示例**：选择 `原材料标准明细` 字段

![步骤3](./docs/step3.png)

**自动检测**：插件会自动显示该字段关联了多少条记录。

**示例显示**：💡 检测到 **11** 条关联记录

---

### 步骤4: 选择目标记录

选择要复制到的目标记录（在同一个主表中）。

**示例**：选择 `凝茶萃取液-HTC8913-003`

![步骤4](./docs/step4.png)

**提示信息**：
> 💡 将从 **凝茶萃取液-HTC8913-002** 的 **原材料标准明细** 复制 **11** 条记录，新记录的关联将指向目标记录

---

### 步骤5: 开始复制

点击「开始复制」按钮，等待复制完成。

![复制中](./docs/copying.png)

**成功提示**：✅ 成功复制 11 条关联记录！

---

## 🔍 复制逻辑说明

### 复制过程

1. **读取源记录的关联记录**
   - 从 HTC8913-002 的"原材料标准明细"字段读取所有关联记录
   - 获取到 11 条检测项记录

2. **复制记录到关联表**
   - 在"原料标准明细表"中创建 11 条新记录
   - 复制所有可复制的字段（跳过公式、查找引用等）

3. **更新关联关系**
   - 新记录的"关联标准一张表"字段 → 指向 HTC8913-003
   - 建立新的双向关联关系

### 字段复制规则

#### 会跳过的字段类型

- ❌ 公式字段
- ❌ 查找引用字段
- ❌ 自动编号字段
- ❌ 修改时间字段
- ❌ 修改人字段
- ❌ 创建时间字段
- ❌ 创建人字段

#### 支持复制的字段类型

- ✅ 文本、数字、单选、多选
- ✅ 日期、复选框、人员
- ✅ 电话、超链接、附件
- ✅ 双向关联字段（会更新为目标记录）
- ✅ 货币、评分、进度
- ✅ 条形码、位置

---

## 💡 使用技巧

### 技巧1: 快速复制标准模板

当你需要创建相似的原料标准时：
1. 选择模板原料标准作为源记录
2. 选择关联字段
3. 选择新创建的原料标准作为目标
4. 一键复制所有检测项

### 技巧2: 批量建立标准

如果有多个新原料标准需要相同的检测项：
1. 重复执行复制操作
2. 每次选择不同的目标记录
3. 快速建立多个标准

### 技巧3: 检查关联记录数量

在步骤3选择关联字段后：
- 查看显示的关联记录数量
- 确认是否是预期的数量
- 避免复制错误的记录

---

## ⚠️ 注意事项

### 1. 关联字段类型

- ✅ 只支持**双向关联字段**（DuplexLink）
- ❌ 不支持单向关联字段（SingleLink）

### 2. 记录选择

- 源记录和目标记录必须在同一个表中
- 目标记录列表会自动排除源记录（防止自己复制给自己）

### 3. 数据安全

- ✅ 不会修改源记录
- ✅ 不会删除任何数据
- ✅ 只在关联表中创建新记录
- ✅ 所有操作在本地完成

### 4. 权限要求

使用插件需要以下权限：
- 读取主表的记录
- 读取关联表的记录
- 向关联表写入新记录

### 5. 性能建议

- 单次复制建议不超过 100 条关联记录
- 复制大量数据时可能需要等待几秒
- 网络不稳定时建议分批操作

---

## ❓ 常见问题

### Q1: 为什么看不到关联字段？

**A**: 可能的原因：
1. 主表中没有双向关联字段
2. 还没有选择源记录
3. 字段类型不是双向关联（DuplexLink）

**解决方法**：
- 确认主表中有双向关联字段
- 先选择源记录，再选择关联字段

---

### Q2: 显示"检测到 0 条关联记录"？

**A**: 说明源记录在该关联字段中没有关联任何记录。

**解决方法**：
- 检查源记录是否正确
- 检查关联字段是否选择正确
- 在飞书表格中确认该记录是否有关联数据

---

### Q3: 复制后关联关系不对？

**A**: 请确认：
1. 选择的是正确的关联字段
2. 目标记录选择正确
3. 关联表中的关联字段名称正确

---

### Q4: 可以复制到不同的表吗？

**A**: 不可以。当前版本只支持在同一个主表的不同记录之间复制关联记录。

**原因**：关联字段的关联关系是固定的，只能关联到特定的表。

---

### Q5: 复制后可以撤销吗？

**A**: 插件本身不提供撤销功能，但你可以：
1. 在飞书多维表格中使用「撤销」功能（Ctrl+Z）
2. 手动删除复制的记录（在关联表中）

---

## 🔧 技术支持

### 浏览器兼容性

建议使用以下浏览器：
- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Safari 14+
- ✅ Firefox 88+

### 遇到问题？

如遇到问题，请检查：

1. **浏览器控制台**（F12）
   - 查看是否有错误信息
   - 截图错误信息以便反馈

2. **网络连接**
   - 确保网络稳定
   - 检查飞书是否正常连接

3. **权限设置**
   - 确认有足够的表格操作权限
   - 联系表格管理员授权

4. **数据格式**
   - 确认关联字段类型正确
   - 确认记录数据完整

---

## 📞 联系我们

如有问题或建议，欢迎反馈：

- 📧 邮箱：[你的邮箱]
- 💬 飞书群：[群号]
- 🐛 问题反馈：[GitHub Issues 链接]

---

## 📊 使用示例

### 示例1: 复制原料标准检测项

**场景**：新建原料标准 HTC8913-003，需要参考 HTC8913-002 的检测项

**操作**：
1. 主表：原料标准管理
2. 源记录：HTC8913-002
3. 关联字段：原材料标准明细
4. 目标记录：HTC8913-003
5. 点击复制 → 成功复制 11 条检测项

**结果**：HTC8913-003 现在有了和 HTC8913-002 相同的检测项配置

---

### 示例2: 批量建立标准模板

**场景**：有 5 个新原料标准需要相同的检测项配置

**操作**：
1. 创建一个模板原料标准（包含所有标准检测项）
2. 依次选择 5 个新原料标准作为目标
3. 重复执行复制操作 5 次

**结果**：5 个新原料标准都有了完整的检测项配置

---

**版本**: v2.0.0  
**更新日期**: 2025-11-22  
**重大更新**: 全新的关联记录复制功能

